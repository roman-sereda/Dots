<script>
$(document).ready(function(){

  var field = document.getElementById("field")

  field.addEventListener("click", getPosition, false);

  for(var i = 0; i < 20; i++){
    var ctx = field.getContext("2d");

    ctx.lineWidth = 1
    ctx.moveTo(20 * i - 1, 0);
    ctx.lineTo(20 * i - 1, 400);
    ctx.stroke();
  }

  for(var i = 0; i < 20; i++){
    var ctx = field.getContext("2d");

    ctx.lineWidth = 1
    ctx.moveTo(0, 20 * i - 1);
    ctx.lineTo(400, 20 * i - 1);
    ctx.stroke();
  }

  <% 20.times do |i| %>
    <% 20.times do |j| %>
      if(<%= points[i][j] %> == 1){
        var point = field.getContext('2d');

        point.beginPath();
        point.arc(<%= i %> * 20, <%= j %> * 20, 7, 0, 2*Math.PI, false);
        point.fillStyle = 'red';
        point.fill();
        point.lineWidth = 1;
        point.strokeStyle = 'red';
        point.stroke();
      }
      else if(<%= points[i][j] %> == 2){
        var point = field.getContext('2d');

        point.beginPath();
        point.arc(<%= i %> * 20, <%= j %> * 20, 7, 0, 2*Math.PI, false);
        point.fillStyle = 'red';
        point.fill();
        point.lineWidth = 1;
        point.strokeStyle = 'red';
        point.stroke();
      }
    <% end %>
  <% end %>

});

function getPosition(event){
  var rect = field.getBoundingClientRect();
  var x = event.clientX - rect.left;
  var y = event.clientY - rect.top;
  console.log("x: " + x + " y: " + y);

  putPoint(x,y)
}

function putPoint(x,y){
  var point = field.getContext('2d');
  if(( x / 20 - ~~( x / 20 )) > 0.5){
    x = ~~(x / 20 + 1)
  }else{
    x = ~~(x / 20)
  };

  if(( y / 20 - ~~( y / 20 )) > 0.5){
    y = ~~(y / 20 + 1)
  }else{
    y = ~~(y / 20)
  };

  point.beginPath();
  point.arc(20 * x, 20 * y, 7, 0, 2*Math.PI, false);
  point.fillStyle = 'red';
  point.fill();
  point.lineWidth = 1;
  point.strokeStyle = 'red';
  point.stroke();

  $.ajax({
    url: "/new_point",
    type: "POST",
    data: { id: <%= field_id %>, x: x, y: y },
    success: function(resp){ }
  });

  checkForZones()
}

function checkForZones(){

}
</script>
